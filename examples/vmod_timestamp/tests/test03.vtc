varnishtest "add_duration()"

server s1 {} -start

varnish v1 -vcl+backend {
    import timestamp from "${vmod}";
    import std;
    import vtc;

    sub vcl_recv {
        return (synth(200));
    }

    sub vcl_synth {
        set resp.http.diff = timestamp.add_duration(now, 3m) - now;
    }
} -start

client c1 {
    txreq
    rxresp
    expect resp.http.diff >= 179.9
    expect resp.http.diff <= 180.1
} -run
